# top

```bash
top
```
## cpu:

- load averages: среднее число процессов, находящихся в очереди на выполнение за последние 1, 5 и 15 минут. Значение зависит от количества задач, которые хотят получить доступ к CPU. Высокое значение указывает на загруженность системы.
- Cpu(s): Показывает распределение времени процессора между различными задачами.
- us: процент времени CPU, затраченного на выполнение процессов в пространстве пользователя (не включая nice-процессы). Зависит от нагрузки пользовательских приложений.
- sy: процент времени CPU, затраченного на выполнение системных (ядра) процессов. Увеличивается при интенсивном использовании системных вызовов.
- ni: процент времени CPU, затраченного на процессы с изменённым приоритетом (nice). Зависит от наличия процессов с изменённым приоритетом.
- id: процент времени, когда CPU бездействует. Высокое значение означает, что процессор не загружен.
- wa: процент времени CPU, ожидающего завершения операций ввода-вывода. Увеличивается при медленной работе дисковой системы или сети.
- hi: процент времени CPU, затраченного на обработку аппаратных прерываний. Зависит от активности оборудования.
- si: процент времени CPU, затраченного на обработку программных прерываний. Увеличивается при высокой сетевой активности.
- st: процент времени, украденного у виртуальной машины гипервизором. Применимо в виртуализированных средах.

## Mem:

- total: общее количество доступной физической памяти в системе.
- used: объем памяти, который используется в данный момент. Включает кеши и буферы.
- free: объем неиспользуемой памяти.
- buff/cache: объем памяти, используемый под буферы и кеши. Зависит от операций ввода-вывода. Буферы - временное хранение данных перед записью на диск. Кеши - хранение данных для ускорения доступа к ним.

## Swap

Отображает использование подкачки.
- total: общее пространство подкачки (swap), доступное системе.
- used: объем подкачки, который используется.
- free: объем свободной подкачки.
- avail Mem: приблизительный объем памяти, доступный для новых приложений без подкачки.

## PR
приоритет процесса. Определяет порядок планирования. Может изменяться системными и пользовательскими настройками.

## NI
значение "niceness" процесса, влияющее на приоритет. Диапазон от -20 (высокий приоритет) до 19 (низкий приоритет).

## VIRT
объем виртуальной памяти, который использует процесс. Включает резидентную память, разделяемые библиотеки и т.д.

## RES
объем физической памяти, который использует процесс. Зависит от текущего использования памяти.

## SHR
объем разделяемой памяти, используемый процессом. Включает разделяемые библиотеки.

## S
состояние процесса:
- R: выполняется (running)
- S: спит (sleeping)
- D: не прерывается (uninterruptible sleep)
- Z: зомби (zombie)
- T: остановлен (stopped)

## %CPU 
процент использования CPU процессом с момента последнего обновления. Зависит от активности процесса. Является суммой всех ядер.

## %MEM
процент использования физической памяти процессом относительно общей памяти.

## TIME+
общее время CPU, затраченное процессом, с точностью до сотых секунды.


# ps

```bash
ps -eo user,rss,vsize,minflt,majflt,pcpu,cmd --user=$(whoami) --sort=-pcpu
```

## Options
- -e: выводит информацию о всех процессах.
- -o: определяет формат вывода информации о процессах.
- rss: (Resident Set Size) объем физической памяти, используемой процессом.
- vsize: (Virtual Memory Size) объем виртуальной памяти, используемой процессом.
- minflt: (Minor Faults) количество малых ошибок памяти. Происходят при обращении к страницам, которые в оперативной памяти, но нет маркировки в таблице страниц.
- majflt: (Major Faults) количество крупных ошибок памяти. Происходят при обращении к страницам, которые не находятся в оперативной памяти.


# mpstat

```bash
mpstat -P ALL 1
```
Выводит статистику использования процессора по каждому ядру.

# pidstat

```bash
pidstat -d -R -r -u -w -G 'io-lat-write|Main|factorize'
```

## Options

### -d
Отображает статистику ввода-вывода:

- kB_rd/s — скорость чтения в кБ/с. 
- kB_wr/s — скорость записи в кБ/с. 
- kB_ccwr/s — скорость записи отменённых страниц в кБ/с. 
- iodelay — задержка ввода-вывода.

### -r
Отображает статистику памяти:

- minflt/s — незначительные отказы страницы в секунду.
- majflt/s — значительные отказы страницы в секунду.
- VSZ — виртуальный размер процесса.
- RSS — резидентный размер процесса.
- %MEM — процент использования памяти.

### -u
Информация о загрузке CPU

### -w
Отображает статистику переключений контекста:

- cswch/s — количество добровольных переключений контекста в секунду. Добровольное переключение контекста происходит, когда процесс завершает свою работу, встаёт на ожидание или thread.sleep и передает управление другому процессу.
- nvcswch/s — количество недобровольных переключений контекста в секунду. Недобровольное переключение контекста происходит, когда процесс завершает свою квант времени и планировщик переключает его на другой процесс.

# /proc/<pid>/stat

```bash
for pid in $(pgrep -f 'factorize|Main|io-lat-write'); do
  cat /proc/$pid/status
  echo "--------------------------------------------------"
done
```

## Output example

```
Name:	factorize
Umask:	0002
State:	R (running)
Tgid:	32807
Ngid:	0
Pid:	32807
PPid:	23471
TracerPid:	0
Uid:	1000	1000	1000	1000
Gid:	1000	1000	1000	1000
FDSize:	64
Groups:	4 24 27 30 46 100 114 1000 
NStgid:	32807
NSpid:	32807
NSpgid:	23471
NSsid:	23439
Kthread:	0
VmPeak:	    6380 kB
VmSize:	    6380 kB
VmLck:	       0 kB
VmPin:	       0 kB
VmHWM:	    3328 kB
VmRSS:	    3328 kB
RssAnon:	     128 kB
RssFile:	    3200 kB
RssShmem:	       0 kB
VmData:	     268 kB
VmStk:	     136 kB
VmExe:	      16 kB
VmLib:	    3712 kB
VmPTE:	      52 kB
VmSwap:	       0 kB
HugetlbPages:	       0 kB
CoreDumping:	0
THP_enabled:	1
untag_mask:	0xffffffffffffffff
Threads:	1
SigQ:	0/126585
SigPnd:	0000000000000000
ShdPnd:	0000000000000000
SigBlk:	0000000000000004
SigIgn:	0000000000000000
SigCgt:	0000000000000000
CapInh:	0000000000000000
CapPrm:	0000000000000000
CapEff:	0000000000000000
CapBnd:	000001ffffffffff
CapAmb:	0000000000000000
NoNewPrivs:	0
Seccomp:	0
Seccomp_filters:	0
Speculation_Store_Bypass:	thread vulnerable
SpeculationIndirectBranch:	conditional enabled
Cpus_allowed:	ffff
Cpus_allowed_list:	0-15
Mems_allowed:	00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000001
Mems_allowed_list:	0
voluntary_ctxt_switches:	0
nonvoluntary_ctxt_switches:	699
x86_Thread_features:	
x86_Thread_features_locked:	
```

## Fields
- Umask: текущая маска создания файлов.
- State: текущее состояние процесса (например, R — выполняется).
- Tgid: идентификатор группы задач.
- Pid: идентификатор процесса.
- PPid: идентификатор родительского процесса.
- Uid/Gid: идентификаторы пользователя и группы.
- FDSize: количество открытых файловых дескрипторов.
- Groups: группы, к которым принадлежит процесс.
- VmPeak: максимальный виртуальный размер памяти.
- VmSize: текущий виртуальный размер памяти.
- VmRSS: текущий резидентный размер памяти.
- Threads: количество потоков в процессе.
- voluntary_ctxt_switches: количество добровольных переключений контекста.
- nonvoluntary_ctxt_switches: количество недобровольных переключений контекста.

# perf

```bash
for pid in $(pgrep -f 'factorize|io-lat-write'); do
    perf stat -d -d -d -p $pid &
done
wait
```